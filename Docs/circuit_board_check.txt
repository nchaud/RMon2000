*** measurements ***
with usb attached + battery & with transmit -> current battery ~ 300ma, never higher than 400ma
with no usb attached + battery -> current battery fluctuates a lot but 13-47ma is consumed WHEN ARDUINO IS OFF.
* (with linear regulator?) *
arduino power consumption with shield power on -> constantly 500mA.
arduino power consumption with shield power off -> 90-140mA as shield LEDs light on&off.
* with ldo *
arduino power consumption with shield power off -> ~50mA, roughly constant
arduino power consumption with shield power on -> start quick peak @ 600mA, 70-140mA (even while transmitting)
* with ldo, but shutdown pin=1 *
arduino power consumption with shield power connected (jst-pin) -> ~54mA constant
arduino power consumption with shield power disconnected (jst-pin) -> ~53mA constant
arduino power consumption with ldo disconnected -> ~52mA constant


when on, default analog-gnd=3 MOhm, analog-5v=0 Ohm
		input_pullup, analog-gnd=0, analog-5v=1 MOhm,
when off, analog-5v=3.7 MOhm, analog-gnd=3.7 MOhm
when off, 5V coming to A0 ping, 60mA constant use 


Analog pins are INPUT only. There is no need to set the mode of analog pins. With this code, you are setting the mode of the digital pin that shares space with the analog pin. Not a good idea, generally.

When dealing with high voltages try and make the circuit robust against component faliure - for instance the high-voltage arm of a voltage-divider should have 2 or more resistors in series (if any one shorts out the others protect you).  The low-voltage side of a resistive divider should have a zener diode to limit voltage.  You might think a resistor can't just short out like this, but it takes just one insect to crawl over it, or one drop of water to fall on it (for instance).

PV-Voltage-Divider (but NO use as dont connect as CC behaviour unknown - common PWR?GND? then will short-circuit): The ATmega328 datasheet recommends that the output impedance of the circuit connected to the ADC input pin be 10 kÎ© or less for good results. 

If the capacitor is too big it can take too long to respond to high frequency demands for current.
It is normal to have multiple capacitors at different locations in a power system - large ones at the power supply, and places like where power enters a board. Medium sized ones to help distribute the power around the place more smoothly, and small ones right by where the electricity is used to respond to the small bug high frequency switching demands of things like microcontrollers and logic chips.

One such test I used to perform involved rapid switching of a sewing machine motor power that tended to drive circuits crazy-if it passed this test, it was considered GOOD-if not, it did not prove anything-LOL

So, the TLDR; is that you use BJTs for building robust interfaces since they usually don't need ESD protection, you use MOSFETs for low-medium current switches, and for really high-current switches you use IGBTs. The distinction between MOSFETs and IGBTs is basically on the basis of efficiency - the heat generated in a MOSFET increases as I^2 since it behaves like a resistor, whereas in a IGBT it increases more like Log[I]. Mosfet is Extremely fragile to destruction by static discharge.

HCPL-7510: The design of the printed circuit board (PCB) should follow good layout practices, such as keeping bypass capacitors close to the supply pins...

103mV -> 2.2mV (10/470)
154mV -> 2.2mV output, 10mA current through R@15Ohms, 11mA current through Vdd1 (15/470)
NO INPUT -> 2.2mV 

vRef=5v(vhdd_2)
15/470 (154mV)
	no input (floating)	= +92mV vhdd_2 -> vout (so 5v-.092= ~4.9V )
	input connected		= 1.16V
	input to ground		= 2.7V 
10/470 (104mV)
	input connected		= +1.725V - 1.689 (constantly fluctuating)
	
	
@vRef=4.9 (680/6800 divider)
Vhdd2-GND = 5.39
15/470 (154mV)
	input connected	but off = 2.42V
	input connected	        = 1.99V
10/470 (104mV)
	input connected		= 2.33V (minimal fluctuation, +/- 2mV)


@vRef=4.38 (1500/6800 divider (theoretical=4.42))
Vhdd2-GND = 5.39
15/470 (154mV)
	input connected	but off = 2.16V
	input connected	        = 2.34V
10/470 (104mV)
	input connected			= 2.66V
	

	

Current Sensor
40W Load implies .16A current
*A/C* Sensor gave 20mV => .3A current use (= 15A*(20mV/1000mV))


Pre-switching-regulator power usage of timer (no LEDs)
@12v - 0.9mA (1.0 with LED) 
@6V - 1.5mA

LP3966: R2=22.8kOhms, 100uF Tantalum has gone on C_IN (still not good enough), 100pF on output (not 68pF)


@LDO Output: 
	330uF Alum cap + 3*100uF caps = 3/3 successess
	330uF Alum cap + 2*100uF caps = 3/3 successess
	330uF Alum cap + 1*100uF caps = 3/3 successess
	330uF Alum cap + 0*100uF caps = 3/3 successess
*WAIT FOR 20 MINS*
	1000uF Alum cap = 1/1 success
	330uF Alum cap + 0*100uF caps = 0/2 successess
	330uF Alum cap + 3*100uF caps = 0/3 successess
	
	
	
	* Current Sensor *
	HCT-0010 - clamp on, $70, 0-4V output	 50A D/C though
	WCS2200  - no board, 17mm diagonal width, +/- 20A (on AliExpress)
	WCM1800	 - has board (less noise then), better accuracy than below but thinner 9mm hole, not clamp on , [[ ideal ]]
	WCM6800  - has board (less noise then), clamp on, +/-25A, clamp on (can easily disappear?), 5V,		 Not available anywhere
	Tamura L31S050S05FS - 5V, 50A, 
	Tamura L03S050D15 - 15V supply voltage

	order hunt backup for current measurement (?)
	solar pv-voltage 100V input caps
	
	//Next tasks
	//		xx Switch off the external power to FONA on start-up until fona needed (so get base voltage steady for good sensor reading)
	//		xx Update Schematic with above switch 
	//		xx Test transmission with 12 readings worth of data and 1kuF cap still ok? yep - same data came out x3
	//		xx Turn off FONA when done 
	//	Add sensor-logic with pins, shunt, current check, temperature etc. + update schematic + add anything to purchase-list. 
		(VERY high precision resistors for pv-voltage-divider + relay/bjt - NOPE, Opto intead)
		
		big resistor for high loads (testing)
		
		Current sensor should be for up to 800W/30A !
		Get Zener/fuses for safety anyway 
		Voltage-divider not enough to ensure minimal current if arduino is off...? bjt?
		Headphone jack as current input?
		ADC corrections - http://www.skillbank.co.uk/arduino/adc.htm
		Ensure PWR_SYS mosfet doesn't float - https://arduino.stackexchange.com/a/46303
	//	EEPROM - Do 1-day quick prototype of having SD card there instead of EEEPROM and add to purchase-list if possible (DIP-sd-card-reader for testing if existing one not working) 
				 Else Add rolling logic test + get the max # of readings that can be loaded&sent + any other software updates/TODOs
	//	Add LEDs/output-print etc. logic for jumpers, directing SIM808's LED to surface of box - rssi check etc.
	//	Run whole board (with timer circuit) test with linear 30V->5V regulator
	//  Get a solid-state-relay to potentially switch off Arduino-circuit (check how muh current MOSFET uses now) and/or FONA module (?)
	//	Add any components from above testing to existing purchase-list
	//	Add a/c to high-voltage dc to simulate pv panels
	//	Keyed connections from pv-voltage-sensor and dc-current-sensor
	//	Get mosfet etc. to simulate inverter-input current use by battery - https://hackaday.com/2020/02/11/build-your-own-active-load/ - OR some big resistors 
	//	Lots of reading on safety around circuit, fuses etc. and add anything extra to purchase-list
	//	Make purchase from purchase-list
	//	[When Components Come] Full test with Tant. Caps instead of Alum. Cap. @LDO-Output + @LDO-Circuit
	//	[When Components Come] EEPROM: Run tests for the bigger memory size
	//	
	
	//Design/PCB
	//	Make sure connections wide enough
	
	
	//Phase 2
		Get bjt instead of mosfet(?)
		Big power test
		Fuses
		external connectors


cap failure should never short circuit; need fuse incase short-circuit
derate the voltage rating by a factor of 3-4 if you want the full capacitance.
we need - switching optimal main regulator **optimised for timer's current** but up to 2A max
	- tantalum caps (or other robust ones at 1k Farads?) and several varieties to be deployed in parallel
	- update tantalum cap on LDO
	- several reverse voltage protection
	- another cheap step-down (several quantity)
	- ldo suitable tantalum caps
	- rigid breadboard circuit cables (?)
	- fuses
Increase the 33PF and 10PF capacitors can effectively eliminate the high frequency interference. A 5.1V/500mW
Zener diode is strongly recommended, the diode can prevent chip from damaging by the voltage surge. These
capacitors and Zener diode should be placed as close as possible to SIM808 VBAT pins.


! Main input regulator switching !


The ERROR pin must be connected to ground if this function is not used
If the sense option pin is not required, the sense pin must be connected to the VOUT pin.
reverse current flow protection from LDO

In designs, caps need to be near devices - <1cm

ESD protection for LDO - https://www.design-reuse.com/articles/42191/low-dropout-ldo-linear-voltage-regulators.html

https://resources.altium.com/p/what-is-esd-and-how-does-it-affect-my-pcb-design

no lipo batt connected to sim808 chip!!

bigger eeprom? slide-out eeprom? + slide-out serial connector to d/l data

learn APNs

add shocky to step-down? 12m@ https://training.ti.com/comparing-synchronous-and-non-synchronous-dcdc-converters (but mainly for heavy loads so no-op?) but shotty makes it much cooler

jumper/switch for timer pin A to reduce time

expose all eeprom pins through header so can connect from externally? Or could have a switch to dump all via serial/ethernet
+ easy put on LED maintenance set/or have secret button for it somewhere with lid?

NB: 1h39 time between cycles, 3m3 between small cycles

circuit capacitors voltage check

resistors check

power unit increase voltage/ensure output is 5V, not less

farnell power adaptor increase in power

1 cap per IC

replace generic connectors in digram with actuals

change timing interval connectors

add test line/board/header

wire sizes check
 
use ferrite beads etc. after fully reading https://simcom.ee/documents/SIM800A/SIM800A_Hardware%20Design_V1.02.pdf

check what happens if all sms full

Zener Test with 2.2kOhm series resistor
5v: diode fwd: across resistor - 3mA 4.3V ; across diode - .7V
	diode rev: across resistor - 0.3mA, 0.7V ; across diode - 4.7V
10v: diode fwd: across resistor - 9.3V ; across diode - .7V
	diode rev: across resistor - 5V ; across diode - 5V


192 kOhm resistor used for 5v-resister on multimeter

	
	